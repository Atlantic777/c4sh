{% extends "base/frontend.html" %}
{% block content %}
<script type="text/javascript">
	$(document).ready(function() {
		$('#honoary_member_number').focus();
		$('#honoary_member_number').select();

		searchTimeout = null;

		doSearch = function() {
			searchTimeout = null;
			var number = $('#honoary_member_number').val();

			$('#honoary_member_number_search').html('');

			if (number == '') {
				$('#honoary_member_number_search').html('');
				return;
			}
			$.ajax({
				type: 'GET',
				url: '/api/honoary_member_number_search/'+number+'/',
				success: function(response) {
					var html = '';
					$.each(response, function(i, result) {
						html = html + '<tr><td style="font-size:medium;height:10px;cursor:pointer;"><span onclick="$(\'#honoary_member_number\').val(\''+result.membership_number+'\');$(\'#honoary_member_number_search\').html(\'\');">#'+result.membership_number+' ('+result.full_name+')</span></td></tr>';
					});
					$('#honoary_member_number_search').html(html);

				}
			});
		}

		$('#honoary_member_number').keyup(function() {
			var uuid = this.value.trim();

			if (uuid.length < 1) {
				$('#honoary_member_number_search').html('');
				return;
			}

			if (searchTimeout == null)
				searchTimeout = setTimeout(function(){doSearch()}, 1000);
		});
	});
</script>
		<div class="notification attention">
			<a href="#" class="close-notification tooltip" title="Hide Notification">x</a>
			<h4>Attention, honorary member identification required!</h4>
			<p>The cart contains Tickets which require honorary member identification! Enter Chaosnummer or full name here.</p>
		</div>


		<article class="content-box col-super2p1">
			<header>
				<h2>Cart</h2>
			</header>
			<section>
				<table id="tickets">
					{% for t in tickets %}
					<tr>
						<td style="text-align:left;padding-left:20px;max-width:300px;">
							<span style="font-size:large;">{{t.name}}</span>
							{% if t.limit_honorary_member %}
							<button class='icon red tooltip' title='Needs supervisor'><img src='{{STATIC_URL}}img/icons/buttons/alert.png'></button>
							<br />
							This Ticket required honorary member identification.
							{% endif %}
						</td>
						<td style="width:150px;">
							{{t.sale_price|floatformat:2}}
							{{t.currency}}
							<br/>
							<small>incl. {{t.tax_rate}}% tax</small>
						</td>
					</tr>
					{% endfor %}

					{% for p in preorder_tickets %}
					<tr>
						<td style="text-align:left;padding-left:20px;max-width:300px;">
							<span style="font-size:large;">{{p.get_backend_ticket.name}}</span>
							{% if p.uuid %}
							<br /><small>{{p.uuid}}</small>
							{% endif %}
						</td>
						<td style="width:150px;">
							{{p.get_backend_ticket.sale_price|floatformat:2}}
							{{p.get_backend_ticket.currency}}
							<br/>
							<small>incl. {{p.get_backend_ticket.tax_rate}}% tax</small>
						</td>
					</tr>
					{% endfor %}
				</table>
				</form>
			</section>
		</article>

		<article class="content-box col-super2p2 clear-rm">
			<header>
				<h2>Honorary member identification</h2>
			</header>
			<section>
				<table id="supervisor">
				</table>
				<table>
					<tr>
						<td style="padding:10px;">
							<form method="POST" action="{% url desk-sell %}" id="honoary_member">
								{% csrf_token %}
								{% for t in positions %}
									<input type="hidden" name="position" value="{{t}}"/>
								{% endfor %}
								{% for p in preorder_tickets %}
									<input type="hidden" name="uuid" value="{{p.uuid}}"/>
								{% endfor %}
								<input type="text" name="honoary_member_number" id="honoary_member_number" style="width:90%;outline:0;" />
							</form>
						</td>
					</tr>
				</table>
				<table id="honoary_member_number_search" style="position:absolute;width:340px;z-index:10000;">
				</table>
				<p><a href="{% url dashboard %}" class="button red">Cancel</a>
				<a href="javascript:$('#honoary_member').submit();" href="{% url dashboard %}" class="button green">Continue</a></p>
			</section>
		</article>
		<div class="clearfix"></div>
{% endblock %}